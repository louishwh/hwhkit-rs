{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h1>
    <p>ç®¡ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·</p>
</div>

<div class="users-section">
    <div class="section-header">
        <h2>ç”¨æˆ·åˆ—è¡¨</h2>
        <button class="btn btn-primary" onclick="showAddUserForm()">æ·»åŠ ç”¨æˆ·</button>
    </div>

    <div class="users-grid">
        {% for user in users %}
        <div class="user-card">
            <div class="user-avatar">
                <span>{{ user.name | first | upper }}</span>
            </div>
            <div class="user-info">
                <h3>{{ user.name }}</h3>
                <p>{{ user.email }}</p>
                <small>ID: {{ user.id }}</small>
            </div>
            <div class="user-actions">
                <button class="btn btn-sm btn-edit" onclick="editUser({{ user.id }})">ç¼–è¾‘</button>
                <button class="btn btn-sm btn-delete" onclick="deleteUser({{ user.id }})">åˆ é™¤</button>
            </div>
        </div>
        {% endfor %}
        
        {% if users | length == 0 %}
        <div class="empty-state">
            <p>æš‚æ— ç”¨æˆ·æ•°æ®</p>
            <button class="btn btn-primary" onclick="showAddUserForm()">æ·»åŠ ç¬¬ä¸€ä¸ªç”¨æˆ·</button>
        </div>
        {% endif %}
    </div>
</div>

<!-- æ·»åŠ ç”¨æˆ·è¡¨å•æ¨¡æ€æ¡† -->
<div id="addUserModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>æ·»åŠ æ–°ç”¨æˆ·</h3>
            <button class="modal-close" onclick="hideAddUserForm()">&times;</button>
        </div>
        <form id="addUserForm" onsubmit="addUser(event)">
            <div class="form-group">
                <label for="userName">å§“å:</label>
                <input type="text" id="userName" name="name" required>
            </div>
            <div class="form-group">
                <label for="userEmail">é‚®ç®±:</label>
                <input type="email" id="userEmail" name="email" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="hideAddUserForm()">å–æ¶ˆ</button>
                <button type="submit" class="btn btn-primary">æ·»åŠ ç”¨æˆ·</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddUserForm() {
    document.getElementById('addUserModal').style.display = 'block';
}

function hideAddUserForm() {
    document.getElementById('addUserModal').style.display = 'none';
    document.getElementById('addUserForm').reset();
}

async function addUser(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const userData = {
        name: formData.get('name'),
        email: formData.get('email')
    };

    try {
        const response = await fetch('/api/v1/users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData)
        });

        if (response.ok) {
            hideAddUserForm();
            location.reload(); // åˆ·æ–°é¡µé¢æ˜¾ç¤ºæ–°ç”¨æˆ·
        } else {
            alert('æ·»åŠ ç”¨æˆ·å¤±è´¥');
        }
    } catch (error) {
        alert('æ·»åŠ ç”¨æˆ·æ—¶å‘ç”Ÿé”™è¯¯');
    }
}

function editUser(userId) {
    // å®ç°ç¼–è¾‘åŠŸèƒ½
    alert(`ç¼–è¾‘ç”¨æˆ· ${userId} çš„åŠŸèƒ½å¾…å®ç°`);
}

function deleteUser(userId) {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) {
        // å®ç°åˆ é™¤åŠŸèƒ½
        alert(`åˆ é™¤ç”¨æˆ· ${userId} çš„åŠŸèƒ½å¾…å®ç°`);
    }
}
</script>
{% endblock content %}